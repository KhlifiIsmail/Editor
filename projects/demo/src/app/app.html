<div class="app-container">
  <!-- Top Header -->
  <header class="app-header">
    <div class="header-left">
      <h1 class="app-title">
        <lucide-icon [img]="icons.Zap" class="title-icon"></lucide-icon>
        Monaco Pattern Editor
      </h1>
    </div>

    <div class="header-right">
      <select
        class="theme-selector"
        [value]="selectedTheme()"
        (change)="onThemeChange($any($event.target).value)">
        <option *ngFor="let theme of availableThemes" [value]="theme.value">
          {{ theme.label }}
        </option>
      </select>

      <button class="theme-toggle" (click)="toggleTheme()">
        <lucide-icon
          *ngIf="themeService.currentMode() === 'dark'"
          [img]="icons.Sun">
        </lucide-icon>
        <lucide-icon
          *ngIf="themeService.currentMode() === 'light'"
          [img]="icons.Moon">
        </lucide-icon>
      </button>
    </div>
  </header>

  <!-- Main Split Layout -->
  <div class="split-container">
    <!-- Left Panel: Problem Description -->
    <div class="left-panel">
      <div class="panel-header">
        <h2>Problem</h2>
      </div>

      <div class="panel-content">
        <div class="problem-section">
          <h3>Two Sum</h3>
          <div class="difficulty easy">Easy</div>
        </div>

        <div class="problem-description">
          <p>
            Given an array of integers <code>nums</code> and an integer <code>target</code>,
            return indices of the two numbers such that they add up to <code>target</code>.
          </p>
          <p>
            You may assume that each input would have exactly one solution, and you may not use the same element twice.
          </p>
          <p>
            You can return the answer in any order.
          </p>
        </div>

        <div class="examples">
          <h4>Example 1:</h4>
          <pre><code>Input: nums = [2,7,11,15], target = 9
Output: [0,1]
Explanation: Because nums[0] + nums[1] == 9, we return [0, 1].</code></pre>

          <h4>Example 2:</h4>
          <pre><code>Input: nums = [3,2,4], target = 6
Output: [1,2]</code></pre>
        </div>

        <div class="constraints">
          <h4>Constraints:</h4>
          <ul>
            <li>2 ≤ nums.length ≤ 10⁴</li>
            <li>-10⁹ ≤ nums[i] ≤ 10⁹</li>
            <li>-10⁹ ≤ target ≤ 10⁹</li>
          </ul>
        </div>

        <!-- Detected Patterns Section -->
        <div class="detected-patterns" *ngIf="detectedPatterns().length > 0">
          <h4>
            <lucide-icon [img]="icons.Target" [size]="16"></lucide-icon>
            Detected Patterns:
          </h4>
          <div class="patterns-list">
            <mpe-pattern-badge
              *ngFor="let pattern of detectedPatterns()"
              [pattern]="pattern">
            </mpe-pattern-badge>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Panel: Editor + Results -->
    <div class="right-panel">
      <!-- Toolbar -->
      <div class="editor-toolbar">
        <div class="toolbar-left">
          <span class="language-label">JavaScript</span>
        </div>

        <div class="toolbar-right">
          <button
            class="toolbar-btn"
            (click)="detectPatterns()"
            [disabled]="isDetecting()">
            <lucide-icon
              [img]="isDetecting() ? icons.Loader2 : icons.Target"
              [size]="16"
              [class.spinning]="isDetecting()">
            </lucide-icon>
            {{ isDetecting() ? 'Detecting...' : 'Detect Patterns' }}
          </button>

          <button class="toolbar-btn" (click)="analyzeComplexity()">
            <lucide-icon [img]="icons.BarChart3" [size]="16"></lucide-icon>
            Complexity
          </button>

          <button class="toolbar-btn" (click)="openHints()">
            <lucide-icon [img]="icons.Lightbulb" [size]="16"></lucide-icon>
            Hint
          </button>

          <button
            class="toolbar-btn run-btn"
            (click)="executeCode()"
            [disabled]="isExecuting()">
            <lucide-icon
              [img]="isExecuting() ? icons.Loader2 : icons.Play"
              [size]="16"
              [class.spinning]="isExecuting()">
            </lucide-icon>
            {{ isExecuting() ? 'Running...' : 'Run' }}
          </button>
        </div>
      </div>

      <!-- Editor Area -->
      <div class="editor-area">
        <mpe-monaco-editor
          [language]="'javascript'"
          [initialCode]="initialCode"
          [height]="'100%'"
          [theme]="selectedTheme()"
          (codeChange)="onCodeChange($event)">
        </mpe-monaco-editor>

        <!-- Complexity Badges Overlay -->
        <div class="complexity-badges" *ngIf="complexity()">
          <mpe-complexity-badge [complexity]="complexity()!" [type]="'time'">
          </mpe-complexity-badge>
          <mpe-complexity-badge [complexity]="complexity()!" [type]="'space'">
          </mpe-complexity-badge>
        </div>
      </div>

      <!-- Test Results Panel (Bottom) -->
      <div class="results-panel" *ngIf="testResults() || isExecuting()">
        <mpe-test-results [result]="testResults()!" [loading]="isExecuting()">
        </mpe-test-results>
      </div>
    </div>
  </div>

  <!-- Hint Overlay Modal -->
  <mpe-hint-overlay
    [hints]="hints()"
    [isOpen]="isHintOverlayOpen()"
    [currentLevel]="currentHintLevel()"
    (close)="closeHints()"
    (nextHint)="onNextHint($event)"
    (previousHint)="onPreviousHint($event)">
  </mpe-hint-overlay>
</div>
